<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="/css/myPage.css">
<title>ë§ˆì´í˜ì´ì§€</title>
</head>
<body>
	<!-- Navbar -->
	<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
		<div class="container">
			<div class="navbar-brand-group">
				<a class="navbar-brand" href="/">Delicious Bee</a>
				<button class="navbar-toggler" type="button"
					data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
					aria-controls="navbarSupportedContent" aria-expanded="false"
					aria-label="Toggle navigation">
					<span class="navbar-toggler-icon"></span>
				</button>
			</div>
			<div class="collapse navbar-collapse" id="navbarSupportedContent">
				<ul class="navbar-nav ms-auto mb-2 mb-lg-0">
					<li class="nav-item"><a href="#"
						th:onclick="|location.href='@{/restaurant/rtwrite}'|"
						class="nav-link">ë§›ì§‘ë“±ë¡</a></li>
					<li class="nav-item"><a class="nav-link" href="#!">ì»¤ë®¤ë‹ˆí‹°</a></li>
					<li class="nav-item" sec:authorize="isAnonymous()"><a
						class="nav-link" id="loginButton" href="#">ë¡œê·¸ì¸</a></li>
					<li class="nav-item" sec:authorize="isAuthenticated()"><a
						class="nav-link" th:href="@{/member/myPage}"
						th:text="${#authentication.principal.nickname}"></a></li>
				</ul>
			</div>
		</div>
	</nav>

	<!-- ë¡œê·¸ì¸ ëª¨ë‹¬ -->
	<div id="loginModal" class="modal">
		<div class="form-container">
			<span class="close" onclick="closeModal()">Ã—</span>
			<p class="title">DeliciousBee</p>
			<form action="/member/login" method="post" class="form">
				<input type="text" name="member_id" class="input" placeholder="ì•„ì´ë””">
				<input type="password" name="password" class="input"
					placeholder="ë¹„ë°€ë²ˆí˜¸">
				<p class="page-link">
					<span class="page-link-label">Forgot Password?</span>
				</p>
				<button class="form-btn" type="submit">Log in</button>
			</form>
			<div class="buttons-container">
				<a th:href="@{/oauth2/authorization/google}"
					class="google-login-button"> <svg stroke="currentColor"
						fill="currentColor" stroke-width="0" version="1.1" x="0px" y="0px"
						class="google-icon" viewBox="0 0 48 48" height="1em" width="1em"
						xmlns="http://www.w3.org/2000/svg">
                        <path fill="#FFC107"
							d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12 c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24 c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"></path>
                        <path fill="#FF3D00"
							d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657 C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"></path>
                        <path fill="#4CAF50"
							d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36 c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"></path>
                        <path fill="#1976D2"
							d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571 c0.001-0.001,0.002-0.001,0.003-0.002l6.19,5.238C36.971,39.205,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z"></path>
                    </svg> <span>Log in with Google</span>
				</a>
			</div>
			<p class="sign-up-label">
				Don't have an account?<span class="sign-up-link">Sign up</span>
			</p>
		</div>
	</div>

	<div class="main-info">
		<!-- ë©”ì¸ ì´ë¯¸ì§€ -->
		<img th:if="${myPage.mainImage == null}" src="/image/back.jpg"
			alt="ê¸°ë³¸ ì´ë¯¸ì§€" class="default-main-image"> <img
			th:unless="${myPage.mainImage == null}"
			th:src="'/myPageImage/' + ${myPage.mainImage.savedFilename}"
			alt="ë©”ì¸ ì´ë¯¸ì§€" class="main-image">
		<!-- í”„ë¡œí•„ ì´ë¯¸ì§€ -->
		<div class="profile-image">
			<img th:if="${myPage.beeMember.profileImage == null}"
				src="/myPageImage/no-profil.png" alt="ê¸°ë³¸ ì´ë¯¸ì§€" class="default-profile-image">
			<img th:unless="${myPage.beeMember.profileImage == null}"
				th:src="'/myPageImage/' + ${myPage.profileImage.savedFilename}"
				alt="ë©”ì¸ ì´ë¯¸ì§€" class="profile-image">
		</div>
	</div>


	<div class="myPageOwner">
		<div class="owner-profile">
			<div class="nickname-header">
				<h4 class="nickname"
					th:text="${myPage.beeMember.nickname} + ' ë‹˜ì˜ ë§ˆì´í˜ì´ì§€' "></h4>
				<span th:with="followService=${@followService}"
					class="follow-button-wrapper">
					<div th:if="${!isOwner}">
						<button th:if="${loginMember != null}"
							th:id="'followButton' + ${myPage.beeMember.member_id}"
							th:text="${followService.isFollowing(loginMember.member_id, myPage.beeMember.member_id)} ? 'ì–¸íŒ”ë¡œìš°' : 'íŒ”ë¡œìš°'"
							th:data-following-id="${myPage.beeMember.member_id}"
							th:class="${followService.isFollowing(loginMember.member_id, myPage.beeMember.member_id)} ? 'follow-button' : 'nofollow'"
							onclick="toggleFollow(this)"></button>
						<div class="no-login-follow">
							<a th:if="${loginMember == null}" th:href="@{login}"
								onclick="return showLoginAlert()" class="nofollow">íŒ”ë¡œìš°</a>
						</div>
						<!-- íŒ”ë¡œì›Œ/íŒ”ë¡œì‰ ëª©ë¡ ë²„íŠ¼ -->
					</div>
					<button class="follow-list" onclick="showFollowersModal()">íŒ”ë¡œì›Œ
						ëª©ë¡</button>
					<button class="follow-list" onclick="showFollowingModal()">íŒ”ë¡œì‰
						ëª©ë¡</button>
				</span>
			</div>
			<h4 class="intro-title">ì†Œê°œê¸€</h4>
			<div class="introduce"
				th:if="${myPage.introduce != null and !myPage.introduce.isEmpty()}"
				th:text="${myPage.introduce}"></div>
			<div class="introduce"
				th:unless="${myPage.introduce != null and !myPage.introduce.isEmpty()}">ì†Œê°œê¸€ì´
				ì—†ìŠµë‹ˆë‹¤</div>
		</div>

		<!-- íŒ”ë¡œì›Œ ëª©ë¡ ëª¨ë‹¬ -->
		<div id="followersModal" class="modal">
			<div class="follow-modal-content">
				<span class="close" onclick="closeFollowersModal()">Ã—</span>
				<h3>íŒ”ë¡œì›Œ ëª©ë¡</h3>
				<p>
					íŒ”ë¡œì›Œìˆ˜: <span th:text="${myPage.beeMember.followerList.size()}"></span>
				</p>
				<ul>
					<li th:each="follower : ${myPage.beeMember.followerList}"><a
						th:href="@{/member/myPage(id=${follower.follower.myPage.id})}"
						th:text="${follower.follower.nickname}"></a></li>
				</ul>
			</div>
		</div>

		<!-- íŒ”ë¡œì‰ ëª©ë¡ ëª¨ë‹¬ -->
		<div id="followingModal" class="modal">
			<div class="follow-modal-content">
				<span class="close" onclick="closeFollowingModal()">Ã—</span>
				<h3>íŒ”ë¡œì‰ ëª©ë¡</h3>
				<p>
					íŒ”ë¡œì›Œìˆ˜: <span th:text="${myPage.beeMember.followingList.size()}"></span>
				</p>
				<ul>
					<li th:each="following : ${myPage.beeMember.followingList}"><a
						th:href="@{/member/myPage(id=${following.following.myPage.id})}"
						th:text="${following.following.nickname}"></a></li>
				</ul>
			</div>
		</div>

		<div class="owner-stats">
			<span th:text="'ë¦¬ë·°í•œìˆ˜ : ' + ${myPage.beeMember.review.size()}"></span>
			<span th:text="'í‰ê·  ë³„ì  : (' + ${averageRating} + '/5.0)'"></span>
			<span th:text="'ì¡°íšŒìˆ˜: ' + ${myPage.hit}"></span> <span
				th:text="'ì˜¤ëŠ˜ ë°©ë¬¸ì ìˆ˜: ' + ${todayVisitCount}"></span> <a
				class="today_visitor" onclick="showVisitorsModal()">ì˜¤ëŠ˜ì˜ ë°©ë¬¸ìë³´ê¸°</a>
		</div>

		<!-- ì˜¤ëŠ˜ì˜ ë°©ë¬¸ì ëª©ë¡ ëª¨ë‹¬ -->
		<div id="visitorsModal" class="modal">
			<div class="visit-modal-content">
				<span class="close" onclick="closeVisitorsModal()">Ã—</span>
				<h3>ì˜¤ëŠ˜ì˜ ë°©ë¬¸ì</h3>
				<ul>
					<li th:each="visit : ${visitors}"><a
						th:href="@{/member/myPage(id=${visit.visitor.myPage.id})}"
						th:text="${visit.visitor.nickname}"></a></li>
				</ul>
			</div>
		</div>

	</div>
	<div class="review-sort-container">
		<select id="reviewSort" class="sort-select" onchange="sortReviews()">
			<option value="createDate">ë¦¬ë·° ì‘ì„± ë‚ ì§œìˆœ</option>
			<option value="visitDate">ë°©ë¬¸ ë‚ ì§œìˆœ</option>
		</select>
	</div>
	<div class="myPageMain">
		<div id="reviewListContainer" th:if="${!reviews.isEmpty()}"
			class="myPageReview">
			<div th:each="review, status : ${reviews}" class="review-box"
				th:id="'reviewBox' + ${status.index}">
				<div class="restaurant_name_head">
					<span><img src="/image/bee.jpg" alt="ë²Œ ì´ë¯¸ì§€"
						style="width: 35px; height: 35px; object-fit: cover;"></span> <a
						th:href="@{/restaurant/rtread(id=${review.restaurant.id})}"
						title="ì‹ë‹¹ ì •ë³´ë¡œ ì´ë™"> <span th:text="${review.restaurant.name}"
						class="restaurant_name" style="text-decoration: none;"></span>
					</a>
					<div class="rating-stars">
						<span th:each="i : ${#numbers.sequence(1, 5)}"> <img
							th:if="${review.rating >= i}" src="/myPageImage/full_star.png"
							alt="ê½‰ ì°¬ ë³„"> <img th:unless="${review.rating >= i}"
							src="/myPageImage/empty_star.png" alt="ë¹ˆ ë³„">
						</span>
					</div>
					<span class="review-date"
						th:text="'ë°©ë¬¸ ë‚ ì§œ :   ' + ${review.visitDate}"></span> <span
						class="go-review"> <a
						th:href="@{/restaurant/rtread/{restaurantId}(restaurantId=${review.restaurant.id}, reviewId=${review.id})}">ë¦¬ë·°ë³´ëŸ¬
							ê°€ê¸°</a>
					</span>
				</div>
				<div class="img-and-review">
					<div class="image-box"
						th:if="${review.attachedFile != null and !review.attachedFile.isEmpty()}">
						<div th:each="file : ${review.attachedFile}">
							<div th:if="${file.saved_filename}">
								<img
									th:src="@{'/review/display?filename='+${file.saved_filename}}"
									alt="Review Image"
									style="width: 160px; height: 160px; object-fit: cover;">
							</div>
						</div>
					</div>
					<div class="image-box"
						th:unless="${review.attachedFile != null and !review.attachedFile.isEmpty()}">
						<img src="/myPageImage/no-review-img.jpg" alt="No Review Image"
							style="width: 160px; height: 160px; object-fit: cover;">
					</div>
					<div class="review-main">
						<div class="review-rating">
							<p>
								ì¹œì ˆ í¬ì¸íŠ¸: <span class="gauge-container"> <span
									class="gauge"
									th:style="'width:' + ${review.kindRating * 33.33} + '%'"></span>
								</span> ë§› í¬ì¸íŠ¸: <span class="gauge-container"> <span
									class="gauge"
									th:style="'width:' + ${review.tasteRating * 33.33} + '%'"></span>
								</span> ê°€ê²© í¬ì¸íŠ¸: <span class="gauge-container"> <span
									class="gauge"
									th:style="'width:' + ${review.priceRating * 33.33} + '%'"></span>
								</span>
							</p>
						</div>
						<div class="review-comment">
							<div class="recommendItems">
								<span>ì¶”ì²œ ë©”ë‰´: </span> <span
									th:each="reviewMenu, iterStat : ${review.reviewMenuList}"
									th:text="${reviewMenu?.menu?.name 
                  					 ?: reviewMenu?.customMenuName 
                   					?: ''} + ${!iterStat.last ? ', ' : ''}"></span>
							</div>
							<div class="review_content"
								th:id="'reviewContent' + ${review.id}"
								th:data-short-content="${review.reviewContents.length() > 100 ? review.reviewContents.substring(0, 100) : review.reviewContents}"
								th:data-full-content="	${review.reviewContents}">
								<span th:if="${review.reviewContents.length() > 100}"
									th:text="${review.reviewContents.substring(0, 100)} + '...'">
								</span> <span th:unless="${review.reviewContents.length() > 100}"
									th:text="${review.reviewContents}"> </span>
								<button th:if="${review.reviewContents.length() > 100}"
									th:id="'moreButton' + ${review.id}" class="more-button"
									th:attr="onclick=|toggleReview(this, '${review.id}')|">ë”ë³´ê¸°</button>
							</div>
							<div class="review-create-date"
								th:text="'ë¦¬ë·° ì‘ì„± ë‚ ì§œ : '+ ${review.createDate}"></div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="no-review"
			th:unless="${!myPage.beeMember.review.isEmpty()}">
			<div class="no-review-info">
				ì‘ì„±ëœ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤ã… 
				<p th:if="${#authentication.isAuthenticated() and isOwner}">
					<a href="rtlist.html">ë¦¬ë·° ì‘ì„±í•˜ëŸ¬ ê°€ê¸°</a> ğŸ‘‰
				</p>
			</div>
		</div>
		<div class="ranking">
			<h2>ë¦¬ë·°ì™•ğŸ‘‘</h2>
			<table class="table table-striped">
				<thead>
					<tr>
						<th>#</th>
						<th style="text-align: left;">ë‹‰ë„¤ì„</th>
						<th style="text-align: light; white-space: nowrap;">ë¦¬ë·° ìˆ˜</th>
					</tr>
				</thead>
				<tbody>
					<tr th:each="myPage, status : ${reviewCount}"
						th:if="${status.index} < 4">
						<td class="center" th:if="${status.index} == 0">ğŸ¥‡</td>
						<td class="center" th:if="${status.index} == 1">ğŸ¥ˆ</td>
						<td class="center" th:if="${status.index} == 2">ğŸ¥‰</td>
						<td class="center" th:unless="${status.index} < 3"
							th:text="${status.index + 1} + ." style="padding-left: 8px;"></td>
						<td class="center"><a
							th:href="@{/member/myPage(id=${myPage.id})}"
							class="nickname-link"> <span
								th:text="${myPage.beeMember.nickname}"></span>
						</a> ë‹˜</td>
						<td class="center" style="text-align: center;"
							th:text="${myPage.beeMember.review.size()}"></td>
					</tr>
				</tbody>
			</table>
			<div class="random-review" id="randomReviewSlider">
				<h3>ì˜¤ëŠ˜ì˜ ë¦¬ë·°</h3>
				<div th:if="${randomReview != null}" class="random-review-item">
					<a
						th:href="@{/restaurant/rtread(id=${randomReview.restaurant.id})}"
						title="ì‹ë‹¹ ì •ë³´ë¡œ ì´ë™"> <span class="restaurant-name"
						th:text="${randomReview.restaurant.name}"></span>
					</a> <img
						th:if="${randomReview.attachedFile != null and !randomReview.attachedFile.isEmpty()}"
						th:each="file : ${randomReview.attachedFile}"
						th:src="@{'/review/display?filename='+${file.saved_filename}}"
						alt="Review Image"
						style="width: 200px; height: 200px; object-fit: cover;"> <img
						th:unless="${randomReview.attachedFile != null and !randomReview.attachedFile.isEmpty()}"
						src="/myPageImage/no-review-img.jpg" alt="No Review Image"
						style="width: 200px; height: 200px; object-fit: cover;">
				</div>
				<div th:unless="${randomReview != null}">
					<p>ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
				</div>
			</div>
		</div>
	</div>

	<div class="goUpdate-button"
		th:if="${loginMember != null and loginMember.member_id == myPage.beeMember.member_id}">
		<button onclick="location.href='/member/updateMyPage'">ìˆ˜ì •í•˜ê¸°</button>
	</div>
	<!-- ìœ„ë¡œê°€ëŠ” í™”ì‚´í‘œ ë²„íŠ¼ -->
	<a href="#" onclick="scrollToTop()" id="scrollToTopButton"> <svg
			xmlns="http://www.w3.org/2000/svg" width="24" height="24"
			viewBox="0 0 24 24" fill="none" stroke="currentColor"
			stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
			class="feather-arrow-up">
            <line x1="12" y1="19" x2="12" y2="5"></line>
            <polyline points="7 10 12 5 17 10"></polyline>
        </svg>
	</a>

	<div class="under-bar">
		<img src="/image/bee.jpg" class="under-image"> <span
			class="under-comment">DeliciousBee</span>
	</div>


	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script>
		// ë¡œê·¸ì¸ ëª¨ë‹¬ ì œì–´
		document
				.getElementById('loginButton')
				.addEventListener(
						'click',
						function(event) {
							event.preventDefault();
							document.getElementById('loginModal').style.display = 'block';
						});

		// ë‹«ê¸° ë²„íŠ¼ í´ë¦­ ì‹œ ëª¨ë‹¬ ë‹«ê¸°
		function closeModal() {
			document.getElementById('loginModal').style.display = 'none';
		}

		// ëª¨ë‹¬ ì™¸ë¶€ ì˜ì—­ í´ë¦­ ì‹œ ëª¨ë‹¬ ë‹«ê¸°
		window.onclick = function(event) {
			let modal = document.getElementById('loginModal');
			if (event.target == modal) {
				modal.style.display = 'none';
			}
		}
		
		//íŒ”ë¡œì›Œ**************
		async function toggleFollow(button) {
    const followingId = button.dataset.followingId;
    const isFollowing = button.textContent === 'ì–¸íŒ”ë¡œìš°';
    const url = isFollowing ? `/unfollow/${followingId}` : `/follow/${followingId}`;

    try {
        const response = await fetch(url, { method: 'POST' });
        const success = await response.json(); 

        if (success) {
            // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë° í´ë˜ìŠ¤ ë³€ê²½
            button.textContent = isFollowing ? 'íŒ”ë¡œìš°' : 'ì–¸íŒ”ë¡œìš°';
            button.classList.toggle('follow-button', !isFollowing); // ì–¸íŒ”ë¡œìš° ì‹œ btn-secondary ì¶”ê°€
            button.classList.toggle('nofollow', isFollowing); // íŒ”ë¡œìš° ì‹œ btn-primary ì¶”ê°€
        } else {
            alert('íŒ”ë¡œìš°/ì–¸íŒ”ë¡œìš° ìš”ì²­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
   			 } catch (error) {
        	console.error('íŒ”ë¡œìš°/ì–¸íŒ”ë¡œìš° ìš”ì²­ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
        	alert('íŒ”ë¡œìš°/ì–¸íŒ”ë¡œìš° ìš”ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
   		  }
		}		
		//ë¡œê·¸ì¸ì•ˆí•œì‚¬ëŒ íŒ”ë¡œì›Œí•˜ë ¤í• ë•Œ**************
		function showLoginAlert() {
	        alert("ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.");
	        return true; // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
	    }
		
		
		//*************íŒ”ë¡œì›Œ íŒ”ë¡œì‰ ëª¨ë‹¬****************
function showFollowersModal() {
    document.getElementById('followersModal').style.display = 'block';
}

// íŒ”ë¡œì›Œ ëª©ë¡ ëª¨ë‹¬ ë‹«ê¸° í•¨ìˆ˜
function closeFollowersModal() {
    document.getElementById('followersModal').style.display = 'none';
}

// íŒ”ë¡œì‰ ëª©ë¡ ëª¨ë‹¬ ì—´ê¸° í•¨ìˆ˜
function showFollowingModal() {
    document.getElementById('followingModal').style.display = 'block';
}

// íŒ”ë¡œì‰ ëª©ë¡ ëª¨ë‹¬ ë‹«ê¸° í•¨ìˆ˜
function closeFollowingModal() {
    document.getElementById('followingModal').style.display = 'none';
}

//ì˜¤ëŠ˜ì˜ ë°©ë¬¸ì ëª©ë¡ ëª¨ë‹¬ ì—´ê¸° í•¨ìˆ˜
function showVisitorsModal() {
    document.getElementById('visitorsModal').style.display = 'block';
}

// ì˜¤ëŠ˜ì˜ ë°©ë¬¸ì ëª©ë¡ ëª¨ë‹¬ ë‹«ê¸° í•¨ìˆ˜
function closeVisitorsModal() {
    document.getElementById('visitorsModal').style.display = 'none';
}



//ë”ë³´ê¸° ë²„íŠ¼
function toggleReview(button, reviewId) {
    const contentElement = document.getElementById('reviewContent' + reviewId);
    const moreButton = document.getElementById('moreButton' + reviewId);

    if (moreButton.textContent === 'ë”ë³´ê¸°') {
        contentElement.innerHTML = contentElement.getAttribute('data-full-content');
        moreButton.textContent = 'ì ‘ê¸°'; 
        // expanded í´ë˜ìŠ¤ ê´€ë ¨ ì½”ë“œ ì œê±°
    } else {
        const shortContent = contentElement.getAttribute('data-short-content');
        contentElement.innerHTML = 'ë¦¬ë·°: ' + shortContent + '...';
        moreButton.textContent = 'ë”ë³´ê¸°';
        // expanded í´ë˜ìŠ¤ ê´€ë ¨ ì½”ë“œ ì œê±°
    }
}

// ìœ„ë¡œê°€ëŠ” í™”ì‚´í‘œ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
function scrollToTop() {
    window.scrollTo({
        top: 0,
        behavior: 'smooth' // ë¶€ë“œëŸ¬ìš´ ìŠ¤í¬ë¡¤ íš¨ê³¼
    });
}

function updateRandomReview() {
    $.ajax({
        url: '/random-review', // ì»¨íŠ¸ë¡¤ëŸ¬ì˜ API URL
        type: 'GET',
        dataType: 'json',
        success: function(data) {
            if (data) { // ë°ì´í„°ê°€ ì¡´ì¬í•˜ëŠ” ê²½ìš°ì—ë§Œ ì—…ë°ì´íŠ¸
                $('#randomReviewSlider .restaurant-name').text(data.restaurantName);

                // ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸ ë¡œì§ ê°œì„ 
                const imageBox = $('#randomReviewSlider .random-review-item');
                imageBox.empty(); // ê¸°ì¡´ ì´ë¯¸ì§€ ì‚­ì œ

                if (data.imageUrl) {
                    $('<img>').attr({
                        src: data.imageUrl,
                        alt: 'Review Image',
                        style: 'width: 200px; height: 200px; object-fit: cover;'
                    }).appendTo(imageBox);
                } else {
                    $('<img>').attr({
                        src: '/myPageImage/no-review-img.jpg',
                        alt: 'No Review Image',
                        style: 'width: 200px; height: 200px; object-fit: cover;'
                    }).appendTo(imageBox);
                }
            }
        },
        error: function(error) {
            console.error('ëœë¤ ë¦¬ë·° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
        }
    });
}

$(document).ready(function() {
    // ì´ˆê¸° ë¡œë”© ì‹œ í•œ ë²ˆ ì‹¤í–‰
    updateRandomReview();

    // 5ì´ˆë§ˆë‹¤ ë°˜ë³µ ì‹¤í–‰
    setInterval(updateRandomReview, 5000); 
});

//ë¦¬ë·°ë¡œ ì´ë™
 function scrollToReview(reviewId) {
    if (reviewId) {
      const reviewElement = document.getElementById('review-' + reviewId);
      if (reviewElement) {
        reviewElement.scrollIntoView({ behavior: 'smooth', block: 'center' }); 
      }
    }
  }

// ì •ë ¬ ìˆœì„œ ë°”ê¾¸ê¸°
 function sortReviews() {
    var sort = document.getElementById("reviewSort").value;
    var url = new URL(window.location.href);
    var params = new URLSearchParams(url.search);

    params.set('sort', sort);
    url.search = params.toString();

    // AJAXë¥¼ ì‚¬ìš©í•˜ì—¬ ì„œë²„ì— ìƒˆë¡œìš´ ë°ì´í„° ìš”ì²­
    $.ajax({
        url: url.toString(), 
        type: 'GET',
        success: function(data) {
            // ì„œë²„ì—ì„œ ë°›ì•„ì˜¨ HTMLì—ì„œ ë¦¬ë·° ëª©ë¡ ë¶€ë¶„ë§Œ ì¶”ì¶œí•˜ì—¬ ì—…ë°ì´íŠ¸
            $('#reviewListContainer').html($(data).find('#reviewListContainer').html()); 
        },
        error: function(error) {
            console.error('AJAX ìš”ì²­ ì‹¤íŒ¨:', error);
        }
    });
}
	</script>

</body>

</html>